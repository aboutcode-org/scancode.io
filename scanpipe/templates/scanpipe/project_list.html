{% extends "scanpipe/base.html" %}

{% block content %}
  <div class="container is-max-desktop">
    <section class="section">
      <h1 class="title">
        ScanCode.io
      </h1>
    </section>

    <section class="section pt-0">
      <div class="is-flex is-justify-content-space-between mb-2">
        <h2 class="subtitle mb-0 pt-2">
          <strong>Projects</strong>
        </h2>
        <a href="{% url 'project_add' %}" class="button is-link">New Project</a>
      </div>

      <div class="field">
        <p class="control has-icons-left">
          <input class="input" type="text" placeholder="Filter projects">
          <span class="icon is-small is-left">
            <i class="fas fa-search"></i>
          </span>
        </p>
      </div>

      {% for project in object_list %}
        {% if forloop.first %}<div class="tile is-ancestor">{% endif %}
        <div class="tile is-parent">
          <article class="tile is-child box">
            <div class="is-flex is-justify-content-space-between">
              <h2 class="subtitle mb-1 has-text-weight-semibold">
                <a href="{% url 'project_detail' project.uuid %}">{{ project }}</a>
              </h2>
              <div class="is-size-5">
                {% url "project_results" project.uuid "json" as project_results_json_url %}
                {% include "scanpipe/includes/link_tooltip.html" with href=project_results_json_url link_content='<i class="fas fa-file-download"></i>' dropdown_content="Download results as <strong>JSON</strong>" only %}
                {% url "project_results" project.uuid "xlsx" as project_results_xlsx_url %}
                {% include "scanpipe/includes/link_tooltip.html" with href=project_results_xlsx_url link_content='<i class="fas fa-file-excel"></i>' dropdown_content="Download results as <strong>XLSX</strong>" only %}
              </div>
            </div>

            <section class="mt-2 mb-4">
              {% if project.runs.all %}
                <nav class="panel">
                  <p class="panel-heading py-2 is-size-6 has-text-weight-normal">
                    Pipelines
                  </p>
                  {% for run in project.runs.all %}
                    <span class="panel-block">
                      {% include "scanpipe/includes/run_status_tag.html" with run=run only %}
                      <span class="ml-2">{{ run.pipeline }}</span>
                    </span>
                  {% endfor %}
                </nav>
              {% else %}
                <i>No Pipelines</i>
              {% endif %}
            </section>

            <p class="is-size-7 has-text-grey">
              {{ project.created_date }}
            </p>
          </article>
        </div>
        {% if forloop.counter|divisibleby:2 %}</div><div class="tile is-ancestor">{% endif %}
        {% if forloop.last %}</div>{% endif %}
      {% empty %}
        <div class="tile is-ancestor">
          <div class="tile is-parent">
            <article class="tile is-child box" style="text-align: center; border-width: 2px; border-style: dashed; border-color: rgb(229, 231, 235);">
              <a href="{% url 'project_add' %}">New Project</a>
            </article>
          </div>
        </div>
      {% endfor %}
    </section>
  </div>
{% endblock %}