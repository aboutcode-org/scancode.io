{% extends "scanpipe/base.html" %}

{% block title %}ScanCode.io: {{ project.name }} - Dependency tree{% endblock %}

{% block content %}
  <div id="content-header" class="container is-max-widescreen mb-3">
    {% include 'scanpipe/includes/navbar_header.html' %}
    <section class="mx-5">
      <div class="is-flex is-justify-content-space-between">
        {% include 'scanpipe/includes/breadcrumb.html' with linked_project=True current="Dependency tree" %}
      </div>
    </section>
  </div>

  <div class="container is-fluid mb-3">
    <div id="tree"></div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6"></script>
  {{ dependency_tree|json_script:"dependency_tree" }}
  <script>
    const data = JSON.parse(document.getElementById("dependency_tree").textContent);

    const plot = Plot.plot({
      axis: null,
      margin: 10,
      marginLeft: 40,
      marginRight: 160,
      width: 928 * 2,
      height: 1800 * 2,
      marks: [
        Plot.tree(d3.hierarchy(data).leaves(), {
          path: (node) => node.ancestors().reverse().map(({ data: { name } }) => name).join("|"),
          delimiter: "|"
        })
      ]
    });

    document.getElementById("tree").appendChild(plot);
  </script>
{% endblock %}