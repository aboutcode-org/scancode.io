{% extends "scanpipe/base.html" %}
{% load static %}
{% block title %}ScanCode.io: {{ project.name }} - Resource{% endblock %}

{% block extrahead %}
<style>
  .hidden {
    display: none;
  }

  .chevron {
    transition: transform 0.2s ease;
    display: inline-block;
  }

  .chevron.rotated {
    transform: rotate(90deg);
  }
</style>
{% endblock %}

{% block content %}
<div class="columns is-gapless is-mobile" style="height: 100vh; margin: 0;">
  <div class="column is-one-third p-4 has-background-white" style="border-right: 1px solid #ccc; overflow-y: auto;">
    <div id="file-tree">
      {% include "scanpipe/panels/file_tree_panel.html" with children=children path=path %}
    </div>
  </div>

  <div class="column p-4 has-background-white" style="overflow-y: auto;">
    <div id="right-pane">
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("click", async function (e) {
  const chevron = e.target.closest("[data-chevron]");
  if (chevron) {
    const folderNode = chevron.closest("[data-folder]");
    const targetId = folderNode.dataset.target;
    const url = folderNode.dataset.url;
    const icon = chevron.querySelector("i");
    const target = document.getElementById("dir-" + targetId);

    if (target.dataset.loaded === "true") {
      target.classList.toggle("hidden");
      
    } else {
      target.classList.remove("hidden");
      const response = await fetch(url + "&tree=true");
      target.innerHTML = await response.text();
      target.dataset.loaded = "true";

      htmx.process(target);
    }

    chevron.classList.toggle("rotated");

    e.stopPropagation();
    return;
  }
});
</script>
{% endblock %}